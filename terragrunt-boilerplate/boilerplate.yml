variables:
  - name: Units
    description: |
      acm
      api-gateway
      aws-lbc
      cloudfront
      ebs-csi-driver
      eks
      iam-role
      kms
      lambda
      rds-lambda
      route53-zones
      route53
      s3
      secrets-manager
      vpc
      webacl
    type: list
    default: []

hooks:
  before:
    - command: bash
      args:
        - "-c"
        - |
          set -e
          
          RED='\033[0;31m'
          GREEN='\033[0;32m'
          NC='\033[0m'
          
          UNITS_DIR="{{ range $i, $unit := .Units }}{{if $i}}-{{end}}{{ $unit | lower }}{{ end }}"
          
          echo "Checking for existing files in {{ outputFolder }}/${UNITS_DIR}..."
          
          OVERWRITE_DETECTED=false
          
          if [ -f "{{ outputFolder }}/${UNITS_DIR}/terragrunt.stack.hcl" ]; then
            echo -e "${RED}ERROR: File 'terragrunt.stack.hcl' already exists in {{ outputFolder }}/${UNITS_DIR}!${NC}"
            OVERWRITE_DETECTED=true
          fi
          
          if [ "$OVERWRITE_DETECTED" = true ]; then
            echo ""
            echo -e "${RED}Generation aborted to prevent overwriting existing files.${NC}"
            echo "Please either:"
            echo "   - Remove the existing file"
            echo "   - Use a different target directory"
            exit 1
          fi
          
          echo -e "${GREEN}No conflicts detected. Proceeding with generation...${NC}"

  after:
    - command: bash
      args:
        - "-c"
        - |
          set -e
          
          RED='\033[0;31m'
          GREEN='\033[0;32m'
          NC='\033[0m'
          
          UNITS_DIR="{{ range $i, $unit := .Units }}{{if $i}}-{{end}}{{ $unit | lower }}{{ end }}"
          
          echo "Verifying generated files in {{ outputFolder }}/${UNITS_DIR}..."
          
          if [ ! -f "{{ outputFolder }}/${UNITS_DIR}/terragrunt.stack.hcl" ]; then
            echo -e "${RED}ERROR: Expected file 'terragrunt.stack.hcl' was not created!${NC}"
            exit 1
          fi
          
          echo -e "${GREEN}Stack configuration generated successfully!${NC}"
          echo "${GREEN}Generated units: {{ range $i, $unit := .Units }}{{if $i}}, {{end}}{{ $unit }}{{ end }}${NC}"
